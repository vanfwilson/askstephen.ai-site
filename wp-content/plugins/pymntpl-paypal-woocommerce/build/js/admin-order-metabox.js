(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);const i=window.jQuery;var n=e.n(i);const r=window.wp.apiFetch;var o=e.n(r);function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const p=n().WCBackboneModal.View.extend({events:c(c({},n().WCBackboneModal.View.prototype.events),{"click .ppcp-capture":"handleCapture","click .ppcp-void":"handleVoid","click .wc-ppcp-nav-item":"toggleSection","change .shipping-carrier":"onShippingCarrierChange","click .ppcp-shipping-submit":"onShippingSubmit"}),initialize:function(e){this.props=e.props,n().WCBackboneModal.View.prototype.initialize.call(this,e),this.captureButton=this.$el.find(".ppcp-capture"),this.voidButton=this.$el.find(".ppcp-void"),this.$el.find(".wc-enhanced-select").selectWoo()},disableButtons:function(){this.captureButton.prop("disabled",!0),this.voidButton.prop("disabled",!0)},enableButtons:function(){this.captureButton.prop("disabled",!1),this.voidButton.prop("disabled",!1)},setProcessingText:function(e){e.data("previous-text",e.text()),e.text(e.data("processing-text"))},resetButtonText:function(e){e.text(e.data("previous-text"))},handleCapture:function(e){var t=this,i=n()(e.currentTarget),r=this.$el.find('[name="ppcp_capture_amount"]').val();this.setProcessingText(i),this.disableButtons(),this.props.handleCapture(r,this.props.order_id).then((function(e){e.code?(t.enableButtons(),t.props.hideLoader(),t.submitError(e.message)):window.location.reload()})).catch((function(e){t.props.hideLoader(),t.submitError(null==e?void 0:e.message)})).finally((function(){t.resetButtonText(i)}))},handleVoid:function(e){var t=this,i=n()(e.currentTarget);this.setProcessingText(i),this.disableButtons(),this.props.handleVoid(this.props.order_id).then((function(e){t.props.hideLoader(),e.code?(t.enableButtons(),t.submitError(e.message)):window.location.reload()})).catch((function(e){t.props.hideLoader(),t.submitError(null==e?void 0:e.message)})).finally((function(){t.resetButtonText(i)}))},submitMessage:function(e,t){var i=this;this.$el.find(".ppcp-order-actions-notices").empty(),this.$el.find(".ppcp-order-actions-notices").prepend('<div class="ppcp-order-actions-notice '.concat(t,'">').concat(e,"</div>")),setTimeout((function(){i.$el.find(".ppcp-order-actions-notices").empty()}),4e3)},submitError:function(e){this.submitMessage(e,"error")},submitSuccess:function(e){this.submitMessage(e,"success")},toggleSection:function(e){var t=n()(e.currentTarget).data("section");this.$el.find(".wc-ppcp-nav-item").removeClass("selected"),n()(e.currentTarget).addClass("selected"),this.$el.find(".wc-ppcp-actions__actions").each((function(e,i){n()(i).data("section")===t?n()(i).show():n()(i).hide()})),this.$el.find("footer [data-section]").hide(),this.$el.find('footer [data-section="'.concat(t,'"]')).show()},onShippingCarrierChange:function(e){n()("#ppcp_carrier").val()===this.$el.find(".carrier-other").data("show-if")?this.$el.find(".carrier-other").show():this.$el.find(".carrier-other").hide()},onShippingSubmit:function(e){var t=this,i={tracking:this.$el.find("#ppcp_tracking").val(),tracking_type:this.$el.find("#ppcp_tracking_type").val(),shipping_status:this.$el.find("#ppcp_shipping_status").val(),carrier:this.$el.find("#ppcp_carrier").val(),carrier_other:this.$el.find("#ppcp_carrier_other").val(),notify_buyer:this.$el.find("#ppcp_notify_buyer").is(":checked")},r=n()(e.currentTarget),o=r.text();r.prop("disabled",!0).text(r.data("processing-text")),n()(e.currentTarget).prop("disabled",!0),this.props.submitShipping(i).then((function(e){e.code?t.submitError(e.message):t.submitSuccess(e.message)})).catch((function(e){var i;if(null!=e&&null!==(i=e.data)&&void 0!==i&&i.params){var n=Object.keys(e.data.params)[0];return t.submitError(e.data.params[n])}t.submitError(null==e?void 0:e.message)})).finally((function(){r.prop("disabled",!1).text(o)}))}});function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initialize()}var t,i;return t=e,(i=[{key:"initialize",value:function(){n()(document.body).on("click",".wc-ppcp-order-actions.button",this.handleClickActions.bind(this))}},{key:"handleClickActions",value:function(e){var t=this;e.preventDefault();var i=n()(e.currentTarget).data("order"),r=n()(e.currentTarget),a=r.data("response");a?this.renderTemplate(a,i):(r.prop("disabled",!0),this.displayLoader(n()(e.currentTarget)),o()({method:"GET",path:"/wc-ppcp/v1/admin/order/".concat(i)}).then((function(e){if(t.hideLoader(),r.prop("disabled",!1),e.code)return alert(e.message);r.data("response",e),t.renderTemplate(e,i)})).catch((function(e){t.hideLoader(),window.alert(null==e?void 0:e.message)})))}},{key:"renderTemplate",value:function(e,t){new p({target:"wc-ppcp-order-actions",string:e,props:{order_id:t,displayLoader:this.displayLoader,hideLoader:this.hideLoader,handleCapture:function(e,t){return o()({method:"POST",path:"/wc-ppcp/v1/admin/order/".concat(t),data:{amount:e}}).then((function(e){return e})).catch((function(e){return e}))},handleVoid:function(e){return o()({method:"DELETE",path:"/wc-ppcp/v1/admin/order/".concat(e)}).then((function(e){return e})).catch((function(e){return e}))},submitShipping:function(e){return o()({method:"POST",path:"/wc-ppcp/v1/admin/order/".concat(t,"/tracking"),data:e})}}})}},{key:"displayLoader",value:function(e){e.append('<div class="wc-ppcp-loader">\n            <div></div>\n            <div></div>\n            <div></div>\n        </div>')}},{key:"hideLoader",value:function(){n()(".wc-ppcp-loader").remove()}}])&&d(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()),(this.wcPPCP=this.wcPPCP||{})["admin-order-metabox"]=t})();
//# sourceMappingURL=admin-order-metabox.js.map